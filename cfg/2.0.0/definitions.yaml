---
version: 2.0.0
id: 1
description: Account Policies
type: domain-controller
groups:
  - id: 1.1
    description: Password Policy
    checks:
      - id: 1.1.1
        description: Ensure 'Enforce password history' is set to '24 or more
          password(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty PasswordHistoryCount
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty PasswordHistoryCount
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 24
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 24 or more password(s):
            Computer Configuration\Policies\Windows Settings\Security Settings\Account
            Policies\Password Policy\Enforce password history
        scored: true
      - id: 1.1.2
        description: Ensure 'Maximum password age' is set to '365 or fewer days, but not
          0' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MaxPasswordAge | Select -ExpandProperty
              TotalDays
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MaxPasswordAge | Select -ExpandProperty TotalDays
        tests:
          bin_op: and
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 365
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 365 or fewer days, but not 0:
           Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Maximum password age
        scored: true
      - id: 1.1.3
        description: Ensure 'Minimum password age' is set to '1 or more day(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MinPasswordAge | Select -ExpandProperty
              TotalDays
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MinPasswordAge | Select -ExpandProperty TotalDays
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 1
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 1 or more day(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password age
        scored: true
      - id: 1.1.4
        description: Ensure 'Minimum password length' is set to '14 or more
          character(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty MinPasswordLength
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty MinPasswordLength
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 14
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 14 or more character(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password length
        scored: true
      - id: 1.1.5
        description: Ensure 'Password must meet complexity requirements' is set to
          'Enabled' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty ComplexityEnabled
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty ComplexityEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "True"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to 14 or more character(s):
               Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Password must meet complexity requirements
        scored: true
      - id: 1.1.6
        description: Ensure 'Relax minimum password length limits' is set to 'Enabled'
          (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\SAM\RelaxMinimumPasswordLengthLimits
            MemberServer: Get-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\SAM\RelaxMinimumPasswordLengthLimits
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "True"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to Enabled:
               Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Relax minimum password length limits
        scored: true
      - id: 1.1.7
        description: Ensure 'Store passwords using reversible encryption' is set to
          'Disabled'
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty ReversibleEncryptionEnabled
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select
              -ExpandProperty ReversibleEncryptionEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: has
                value: "False"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the
          following UI path to Disabled:
                Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Store passwords using reversible encryption
        scored: true
  - id: 1.2
    description: Account Lockout Policy
    checks:
      - id: 1.2.1
        description: Ensure 'Account lockout duration' is set to '15 or more minute(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutDuration | Select -ExpandProperty Minutes
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutDuration | Select -ExpandProperty Minutes
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 15
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Account lockout duration
        scored: true
      - id: 1.2.2
        description: Ensure 'Account lockout threshold' is set to '5 or fewer invalid logon attempt(s), but not 0' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutThreshold
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
               Select -ExpandProperty LockoutThreshold
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 5
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 5 or fewer invalid login attempt(s), but not 0:
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Account lockout threshold
        scored: true
      - id: 1.2.3
        description: Ensure 'Allow Administrator account lockout' is set to 'Enabled' (Manual)
        type: manual
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policies\Allow Administrator account lockout
        scored: true

      - id: 1.2.4
        description: Ensure 'Reset account lockout counter after' is set to '15 or more minute(s)' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty LockoutObservationWindow | Select -ExpandProperty Minutes
            MemberServer: Get-ADDefaultDomainPasswordPolicy -Current LocalComputer |
              Select -ExpandProperty LockoutObservationWindow | Select -ExpandProperty Minutes
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 15
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 15 or more minute(s):
              Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Account Lockout Policy\Reset account lockout counter after
        scored: true
  - id: 2.2
    description: User Rights Assignment
    checks:
      - id: 2.2.1
        description: Ensure 'Access Credential Manager as a trusted caller' is set to 'No One' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTrustedCredManAccessPrivilege" ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTrustedCredManAccessPrivilege" ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true

        remediation: >
          To establish the recommended configuration via GP, set the following UI path to "No One":
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access Credential Manager as a trusted caller
        scored: true
      - id: 2.2.2
        description: Ensure 'Access this computer from the network' is set to 'Administrators, Authenticated Users, ENTERPRISE DOMAIN CONTROLLERS' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeNetworkLogonRight") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544,S-1-5-11,S-1-5-9"
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access this computer from the network
        scored: true
      - id: 2.2.3
        description: Ensure 'Access this computer from the network' is set to 'Administrators, Authenticated Users' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            MemberServer: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeNetworkLogonRight") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544,S-1-5-11"
              set: true

        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Access this computer from the network
        scored: true
      - id: 2.2.4
        description: Ensure 'Act as part of the operating system' is set to 'No One' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTcbPrivilege" ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; Get-Content seccfg | Select-String -Pattern "SeTcbPrivilege" ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to "No One":
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Act as part of the operating system
        scored: true
      - id: 2.2.5
        description: Ensure 'Add workstations to domain' is set to 'Administrators' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas USER_RIGHTS /quiet ; (Get-Content seccfg | Select-String -Pattern "SeMachineAccountPrivilege") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: valid_elements
                value: "S-1-5-32-544"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to Administrators:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\User Rights Assignment\Add workstations to domain
        scored: true
  - id: 2.3
    description: Security Options
    checks:
      - id: 2.3.1.1
        description: Ensure 'Block Microsoft accounts' is set to 'Users can't add or log on with Microsoft accounts' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' noconnecteduser
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' noconnecteduser
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "3"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Users can't add or log on with Microsoft accounts':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Block Microsoft accounts
        scored: true
      - id: 2.3.1.2
        description: Ensure 'Guest account status' is set to 'Disabled' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            MemberServer: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "EnableGuestAccount") -replace '^.*= |[*]' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Guest account status
        scored: true
      - id: 2.3.1.3
        description: Ensure 'Limit local account use of blank passwords to console logon only' is set to 'Enabled' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' LimitBlankPasswordUse
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' LimitBlankPasswordUse
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Limit local account use of blank passwords to console logon only
        scored: true
      - id: 2.3.1.4
        description: Configure 'Rename administrator account' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewAdministratorName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewAdministratorName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: "Administrator"
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Rename administrator account
        scored: true
      - id: 2.3.1.5
        description: Configure 'Rename guest account' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewGuestName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
            MemberServer: SecEdit /export /cfg seccfg /areas SecurityPolicy /quiet ; (Get-Content seccfg | Select-String -Pattern "NewGuestName") -replace '.*"([^"]+)".*','$1' ; Remove-Item seccfg
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: "Guest"
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Accounts: Rename guest account
        scored: true
      - id: 2.3.2.1
        description: "Ensure 'Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Control\Lsa' SCENoApplyLegacyAuditPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' SCENoApplyLegacyAuditPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings
        scored: true
      - id: 2.3.2.2
        description: "Ensure 'Audit: Shut down system immediately if unable to log security audits' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Control\Lsa' CrashOnAuditFail
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' CrashOnAuditFail
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Audit: Shut down system immediately if unable to log security audits
        scored: true
      - id: 2.3.4.1
        description: "Ensure 'Devices: Allowed to format and eject removable media' is set to 'Administrators' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' AllocateDASD
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' AllocateDASD
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Administrators':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Devices: Allowed to format and eject removable media
        scored: true
      - id: 2.3.4.2
        description: "Ensure 'Devices: Prevent users from installing printer drivers' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers' AddPrinterDrivers
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers' AddPrinterDrivers
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Devices: Prevent users from installing printer drivers
        scored: true
      - id: 2.3.5.1
        description: "Ensure 'Domain controller: Allow server operators to schedule tasks' is set to 'Disabled' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Control\Lsa' SubmitControl
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: Allow server operators to schedule tasks
        scored: true
      - id: 2.3.5.2
        description: "Ensure 'Domain controller: Allow vulnerable Netlogon secure channel connections' is set to 'Not Configured' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\System\CurrentControlSet\Services\Netlogon\Parameters' VulnerableChannelAllowList
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Not Configured':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: Allow vulnerable Netlogon secure channel connections
        scored: true
      - id: 2.3.5.3
        description: "Ensure 'Domain controller: LDAP server channel binding token requirements' is set to 'Always' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters' LdapEnforceChannelBinding
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Always':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: LDAP server channel binding token requirements
        scored: true
      - id: 2.3.5.4
        description: "Ensure 'Domain controller: LDAP server signing requirements' is set to 'Require signing' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NTDS\Parameters' LDAPServerIntegrity
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Require signing':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: LDAP server signing requirements
        scored: true
      - id: 2.3.5.5
        description: "Ensure 'Domain controller: Refuse machine account password changes' is set to 'Disabled' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RefusePasswordChange
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain controller: Refuse machine account password changes
        scored: true
      - id: 2.3.6.1
        description: "Ensure 'Domain member: Digitally encrypt or sign secure channel data (always)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireSignOrSeal
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireSignOrSeal
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Digitally encrypt or sign secure channel data (always)
        scored: true
      - id: 2.3.6.2
        description: "Ensure 'Domain member: Digitally encrypt secure channel data (when possible)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SealSecureChannel
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SealSecureChannel
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Digitally encrypt secure channel data (when possible)
        scored: true
      - id: 2.3.6.3
        description: "Ensure 'Domain member: Digitally sign secure channel data (when possible)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SignSecureChannel
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' SignSecureChannel
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Digitally sign secure channel data (when possible)
        scored: true
      - id: 2.3.6.4
        description: "Ensure 'Domain member: Disable machine account password changes' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' DisablePasswordChange
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' DisablePasswordChange
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Disable machine account password changes
        scored: true
      - id: 2.3.6.5
        description: "Ensure 'Domain member: Maximum machine account password age' is set to '30 or fewer days, but not 0' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' MaximumPasswordAge
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' MaximumPasswordAge
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 30
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 30 or fewer days, but not 0:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Maximum machine account password age
        scored: true
      - id: 2.3.6.6
        description: "Ensure 'Domain member: Require strong (Windows 2000 or later) session key' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireStrongKey
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters' RequireStrongKey
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Domain member: Require strong (Windows 2000 or later) session key
        scored: true
      - id: 2.3.7.1
        description: "Ensure 'Interactive logon: Do not require CTRL+ALT+DEL' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DisableCAD
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DisableCAD
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Do not require CTRL+ALT+DEL
        scored: true
      - id: 2.3.7.2
        description: "Ensure 'Interactive logon: Don't display last signed-in' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DontDisplayLastUserName
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' DontDisplayLastUserName
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Don't display last signed-in
        scored: true
      - id: 2.3.7.3
        description: "Ensure 'Interactive logon: Machine inactivity limit' is set to '900 or fewer second(s), but not 0' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' InactivityTimeoutSecs
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' InactivityTimeoutSecs
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 900
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '900 or fewer seconds, but not 0':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Machine inactivity limit
        scored: true
      - id: 2.3.7.4
        description: "Configure 'Interactive logon: Message text for users attempting to log on' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeText
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeText
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path to a value that is consistent with the security and operational requirements of your organization:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Message text for users attempting to log on
        scored: true
      - id: 2.3.7.5
        description: "Configure 'Interactive logon: Message title for users attempting to log on' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeCaption
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LegalNoticeCaption
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: ""
              set: true
        remediation: >
          To establish the recommended configuration via GP, configure the following UI path to a value that is consistent with the security and operational requirements of your organization:
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Message title for users attempting to log on
        scored: true
      - id: 2.3.7.6
        description: "Ensure 'Interactive logon: Number of previous logons to cache (in case domain controller is not available)' is set to '4 or fewer logon(s)' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' CachedLogonsCount
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 4
              set: true
            - flag: ""
              compare:
                op: noteq
                value: 0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 4 or fewer logon(s):
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Number of previous logons to cache (in case domain controller is not available)
        scored: true
      - id: 2.3.7.7
        description: "Ensure 'Interactive logon: Prompt user to change password before expiration' is set to 'between 5 and 14 days' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' PasswordExpiryWarning
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' PasswordExpiryWarning
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 14
              set: true
            - flag: ""
              compare:
                op: gte
                value: 5
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to a value 'between 5 and 14 days':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Prompt user to change password before expiration
        scored: true
      - id: 2.3.7.8
        description: "Ensure 'Interactive logon: Require Domain Controller Authentication to unlock workstation' is set to 'Enabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ForceUnlockLogon
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To implement the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Require Domain Controller Authentication to unlock workstation
        scored: true
      - id: 2.3.7.9
        description: "Ensure 'Interactive logon: Smart card removal behavior' is set to 'Lock Workstation' or higher (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ScRemoveOption
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ScRemoveOption
        tests:
          test_items:
            - flag: ""
              compare:
                op: noteq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to Lock Workstation (or, if applicable for your environment, Force Logoff or Disconnect if a Remote Desktop Services session):
             Computer Configuration\Policies\Windows Settings\Security Settings\Local Policies\Security Options\Interactive logon: Smart card removal behavior
        scored: true

  - id: 5
    description: System Services
    checks:
      - id: 5.1
        description: Ensure 'Print Spooler (Spooler)' is set to 'Disabled' (DC only) (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Spooler' Start
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Print Spooler
        scored: true
      - id: 5.2
        description: Ensure 'Print Spooler (Spooler)' is set to 'Disabled' (MS only) (Automated)
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Spooler' Start
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Windows Settings\Security Settings\System Services\Print Spooler
        scored: true
  - id: 9.1
    description: Domain Profile
    checks:
      - id: 9.1.1
        description: "Ensure 'Windows Firewall: Domain: Firewall state' is set to 'On (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' EnableFirewall
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' EnableFirewall
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'On (recommended)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Firewall state
        scored: true
      - id: 9.1.2
        description: "Ensure 'Windows Firewall: Domain: Inbound connections' is set to 'Block (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultInboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultInboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Block (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Inbound connections
        scored: true
      - id: 9.1.3
        description: "Ensure 'Windows Firewall: Domain: Outbound connections' is set to 'Allow (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultOutboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DefaultOutboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Allow (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Outbound connections
        scored: true
      - id: 9.1.4
        description: "Ensure 'Windows Firewall: Domain: Settings: Display a notification' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DisableNotifications
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile' DisableNotifications
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Settings Customize\Display a notification
        scored: true
      - id: 9.1.5
        description: >
          "Ensure 'Windows Firewall: Domain: Logging: Name' is set to "
            '%SystemRoot%\System32\logfiles\firewall\domainfw.log'
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFilePath
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFilePath
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: '%SystemRoot%\System32\logfiles\firewall\domainfw.log'
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '%SystemRoot%\System32\logfiles\firewall\domainfw.log':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Name
        scored: true
      - id: 9.1.6
        description: "Ensure 'Windows Firewall: Domain: Logging: Size limit (KB)' is set to '16,384 KB or greater' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFileSize
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogFileSize
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 16384
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '16,384 KB or greater':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Size limit (KB)
        scored: true
      - id: 9.1.7
        description: "Ensure 'Windows Firewall: Domain: Logging: Log dropped packets' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogDroppedPackets
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogDroppedPackets
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Log dropped packets
        scored: true
      - id: 9.1.8
        description: "Ensure 'Windows Firewall: Domain: Logging: Log successful connections' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogSuccessfulConnections
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\DomainProfile\Logging' LogSuccessfulConnections
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Domain Profile\Logging Customize\Log successful connections
        scored: true
  - id: 9.2
    description: Private Profile
    checks:
      - id: 9.2.1
        description: "Ensure 'Windows Firewall: Private: Firewall state' is set to 'On (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' EnableFirewall
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' EnableFirewall
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'On (recommended)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Firewall state
        scored: true
      - id: 9.2.2
        description: "Ensure 'Windows Firewall: Private: Inbound connections' is set to 'Block (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultInboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultInboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Block (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Inbound connections
        scored: true
      - id: 9.2.3
        description: "Ensure 'Windows Firewall: Private: Outbound connections' is set to 'Allow (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultOutboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DefaultOutboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Allow (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Outbound connections
        scored: true
      - id: 9.2.4
        description: "Ensure 'Windows Firewall: Private: Settings: Display a notification' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DisableNotifications
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile' DisableNotifications
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Settings Customize\Display a notification
        scored: true
      - id: 9.2.5
        description: >
          "Ensure 'Windows Firewall: Private: Logging: Name' is set to "
            '%SystemRoot%\System32\logfiles\firewall\privatefw.log' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFilePath
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFilePath
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: '%SystemRoot%\System32\logfiles\firewall\privatefw.log'
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '%SystemRoot%\System32\logfiles\firewall\privatefw.log':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Name
        scored: true
      - id: 9.2.6
        description: "Ensure 'Windows Firewall: Private: Logging: Size limit (KB)' is set to '16,384 KB or greater' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFileSize
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogFileSize
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 16384
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '16,384 KB or greater':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Size limit (KB)
        scored: true
      - id: 9.2.7
        description: "Ensure 'Windows Firewall: Private: Logging: Log dropped packets' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogDroppedPackets
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogDroppedPackets
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Log dropped packets
        scored: true
      - id: 9.2.8
        description: "Ensure 'Windows Firewall: Private: Logging: Log successful connections' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogSuccessfulConnections
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PrivateProfile\Logging' LogSuccessfulConnections
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Private Profile\Logging Customize\Log successful connections
        scored: true
  - id: 9.3
    description: Public Profile
    checks:
      - id: 9.3.1
        description: "Ensure 'Windows Firewall: Public: Firewall state' is set to 'On (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' EnableFirewall
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' EnableFirewall
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'On (recommended)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Firewall state
        scored: true
      - id: 9.3.2
        description: "Ensure 'Windows Firewall: Public: Inbound connections' is set to 'Block (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultInboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultInboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Block (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Inbound connections
        scored: true
      - id: 9.3.3
        description: "Ensure 'Windows Firewall: Public: Outbound connections' is set to 'Allow (default)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultOutboundAction
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DefaultOutboundAction
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Allow (default)':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Outbound connections
        scored: true
      - id: 9.3.4
        description: "Ensure 'Windows Firewall: Public: Settings: Display a notification' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DisableNotifications
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' DisableNotifications
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Settings Customize\Display a notification
        scored: true
      - id: 9.3.5
        description: "Ensure 'Windows Firewall: Public: Settings: Apply local firewall rules' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalPolicyMerge
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalPolicyMerge
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Settings Customize\Apply local firewall rules
        scored: true
      - id: 9.3.6
        description: "Ensure 'Windows Firewall: Public: Settings: Apply local connection security rules' is set to 'No' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalIPsecPolicyMerge
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile' AllowLocalIPsecPolicyMerge
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'No':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Settings Customize\Apply local connection security rules
        scored: true
      - id: 9.3.7
        description: >
          "Ensure 'Windows Firewall: Public: Logging: Name' is set to "
            '%SystemRoot%\System32\logfiles\firewall\publicfw.log' (Automated)
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFilePath
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFilePath
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: '%SystemRoot%\System32\logfiles\firewall\publicfw.log'
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '%SystemRoot%\System32\logfiles\firewall\publicfw.log':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Name
        scored: true
      - id: 9.3.8
        description: "Ensure 'Windows Firewall: Public: Logging: Size limit (KB)' is set to '16,384 KB or greater' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFileSize
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogFileSize
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 16384
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to '16,384 KB or greater':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Size limit (KB)
        scored: true
      - id: 9.3.9
        description: "Ensure 'Windows Firewall: Public: Logging: Log dropped packets' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogDroppedPackets
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogDroppedPackets
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Log dropped packets
        scored: true
      - id: 9.3.10
        description: "Ensure 'Windows Firewall: Public: Logging: Log successful connections' is set to 'Yes' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogSuccessfulConnections
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\WindowsFirewall\PublicProfile\Logging' LogSuccessfulConnections
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Yes':
             Computer Configuration\Policies\Windows Settings\Security Settings\Windows Firewall with Advanced Security\Windows Firewall with Advanced Security\Windows Firewall Properties\Public Profile\Logging Customize\Log successful connections
        scored: true

  - id: 17.1
    description: Account Logon
    checks:
      - id: 17.1.1
        description: "Ensure 'Audit Credential Validation' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Credential Validation" | Select-String -Pattern 'Credential Validation' ) -replace ".*Credential Validation\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Credential Validation" | Select-String -Pattern 'Credential Validation' ) -replace ".*Credential Validation\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Logon\Audit Credential Validation
        scored: true
      - id: 17.1.2
        description: "Ensure 'Audit Kerberos Authentication Service' is set to 'Success and Failure' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Kerberos Authentication Service" | Select-String -Pattern 'Kerberos Authentication Service' ) -replace ".*Kerberos Authentication Service\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Logon\Audit Kerberos Authentication Service
        scored: true
      - id: 17.1.3
        description: "Ensure 'Audit Kerberos Service Ticket Operations' is set to 'Success and Failure' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Kerberos Service Ticket Operations" | Select-String -Pattern 'Kerberos Service Ticket Operations' ) -replace ".*Kerberos Service Ticket Operations\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Logon\Audit Kerberos Service Ticket Operations
        scored: true
  - id: 17.2
    description: Account Management
    checks:
      - id: 17.2.1
        description: "Ensure 'Audit Application Group Management' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Application Group Management" | Select-String -Pattern 'Application Group Management' ) -replace ".*Application Group Management\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Application Group Management" | Select-String -Pattern 'Application Group Management' ) -replace ".*Application Group Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Application Group Management
        scored: true
      - id: 17.2.2
        description: "Ensure 'Audit Computer Account Management' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Computer Account Management" | Select-String -Pattern 'Computer Account Management' ) -replace ".*Computer Account Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Computer Account Management
        scored: true
      - id: 17.2.3
        description: "Ensure 'Audit Distribution Group Management' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Distribution Group Management" | Select-String -Pattern 'Distribution Group Management' ) -replace ".*Distribution Group Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Distribution Group Management
        scored: true
      - id: 17.2.4
        description: "Ensure 'Audit Other Account Management Events' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Account Management Events" | Select-String -Pattern 'Other Account Management Events' ) -replace ".*Other Account Management Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Other Account Management Events
        scored: true
      - id: 17.2.5
        description: "Ensure 'Audit Security Group Management' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Security Group Management" | Select-String -Pattern 'Security Group Management' ) -replace ".*Security Group Management\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Security Group Management" | Select-String -Pattern 'Security Group Management' ) -replace ".*Security Group Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit Security Group Management
        scored: true
      - id: 17.2.6
        description: "Ensure 'Audit User Account Management' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"User Account Management" | Select-String -Pattern 'User Account Management' ) -replace ".*User Account Management\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"User Account Management" | Select-String -Pattern 'User Account Management' ) -replace ".*User Account Management\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Account Management\Audit User Account Management
        scored: true
  - id: 17.3
    description: Detailed Tracking
    checks:
      - id: 17.3.1
        description: "Ensure 'Audit PNP Activity' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Plug and Play Events" | Select-String -Pattern 'Plug and Play Events' ) -replace ".*Plug and Play Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Plug and Play Events" | Select-String -Pattern 'Plug and Play Events' ) -replace ".*Plug and Play Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Detailed Tracking\Audit PNP Activity
        scored: true
      - id: 17.3.2
        description: "Ensure 'Audit Process Creation' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Process Creation" | Select-String -Pattern 'Process Creation' ) -replace ".*Process Creation\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Process Creation" | Select-String -Pattern 'Process Creation' ) -replace ".*Process Creation\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Detailed Tracking\Audit Process Creation
        scored: true
  - id: 17.4
    description: DS Access
    checks:
      - id: 17.4.1
        description: "Ensure 'Audit Directory Service Access' is set to include 'Failure' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Directory Service Access" | Select-String -Pattern 'Directory Service Access' ) -replace ".*Directory Service Access\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\DS Access\Audit Directory Service Access
        scored: true
      - id: 17.4.2
        description: "Ensure 'Audit Directory Service Changes' is set to include 'Success' (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Directory Service Changes" | Select-String -Pattern 'Directory Service Changes' ) -replace ".*Directory Service Changes\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\DS Access\Audit Directory Service Changes
        scored: true
  - id: 17.5
    description: Logon/Logoff
    checks:
      - id: 17.5.1
        description: "Ensure 'Audit Account Lockout' is set to include 'Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Account Lockout" | Select-String -Pattern 'Account Lockout' ) -replace ".*Account Lockout\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Account Lockout" | Select-String -Pattern 'Account Lockout' ) -replace ".*Account Lockout\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Account Lockout
        scored: true
      - id: 17.5.2
        description: "Ensure 'Audit Group Membership' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Group Membership" | Select-String -Pattern 'Group Membership' ) -replace ".*Group Membership\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Group Membership" | Select-String -Pattern 'Group Membership' ) -replace ".*Group Membership\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Group Membership
        scored: true
      - id: 17.5.3
        description: "Ensure 'Audit Logoff' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Logoff" | Select-String -Pattern ' Logoff' ) -replace ".*Logoff\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Logoff" | Select-String -Pattern ' Logoff' ) -replace ".*Logoff\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Logoff
        scored: true
      - id: 17.5.4
        description: "Ensure 'Audit Logon' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Logon" | Select-String -Pattern 'Logon ' ) -replace ".*Logon\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Logon" | Select-String -Pattern 'Logon ' ) -replace ".*Logon\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Logon
        scored: true
      - id: 17.5.5
        description: "Ensure 'Audit Other Logon/Logoff Events' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Logon/Logoff Events" | Select-String -Pattern 'Other Logon/Logoff Events' ) -replace ".*Other Logon/Logoff Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other Logon/Logoff Events" | Select-String -Pattern 'Other Logon/Logoff Events' ) -replace ".*Other Logon/Logoff Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Other Logon/Logoff Events
        scored: true
      - id: 17.5.6
        description: "Ensure 'Audit Special Logon' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Special Logon" | Select-String -Pattern 'Special Logon' ) -replace ".*Special Logon\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Special Logon" | Select-String -Pattern 'Special Logon' ) -replace ".*Special Logon\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Logon/Logoff\Audit Special Logon
        scored: true
  - id: 17.6
    description: Object Access
    checks:
      - id: 17.6.1
        description: "Ensure 'Audit Detailed File Share' is set to include 'Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Detailed File Share" | Select-String -Pattern 'Detailed File Share' ) -replace ".*Detailed File Share\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Detailed File Share" | Select-String -Pattern 'Detailed File Share' ) -replace ".*Detailed File Share\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Detailed File Share
        scored: true
      - id: 17.6.2
        description: "Ensure 'Audit File Share' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"File Share" | Select-String -Pattern 'File Share' ) -replace ".*File Share\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"File Share" | Select-String -Pattern 'File Share' ) -replace ".*File Share\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit File Share
        scored: true
      - id: 17.6.3
        description: "Ensure 'Audit Other Object Access Events' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Object Access Events" | Select-String -Pattern 'Other Object Access Events' ) -replace ".*Other Object Access Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other Object Access Events" | Select-String -Pattern 'Other Object Access Events' ) -replace ".*Other Object Access Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Other Object Access Events
        scored: true
      - id: 17.6.4
        description: "Ensure 'Audit Removable Storage' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Removable Storage" | Select-String -Pattern 'Removable Storage' ) -replace ".*Removable Storage\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Removable Storage" | Select-String -Pattern 'Removable Storage' ) -replace ".*Removable Storage\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Object Access\Audit Removable Storage
        scored: true
  - id: 17.7
    description: Policy Change
    checks:
      - id: 17.7.1
        description: "Ensure 'Audit Audit Policy Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Audit Policy Change
        scored: true
      - id: 17.7.2
        description: "Ensure 'Audit Authentication Policy Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Audit Policy Change" | Select-String -Pattern 'Audit Policy Change' ) -replace ".*Audit Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authentication Policy Change
        scored: true
      - id: 17.7.3
        description: "Ensure 'Audit Authorization Policy Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Authorization Policy Change" | Select-String -Pattern 'Authorization Policy Change' ) -replace ".*Authorization Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Authorization Policy Change" | Select-String -Pattern 'Authorization Policy Change' ) -replace ".*Authorization Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Authorization Policy Change
        scored: true
      - id: 17.7.4
        description: "Ensure 'Audit MPSSVC Rule-Level Policy Change' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"MPSSVC Rule-Level Policy Change" | Select-String -Pattern 'MPSSVC Rule-Level Policy Change' ) -replace ".*MPSSVC Rule-Level Policy Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"MPSSVC Rule-Level Policy Change" | Select-String -Pattern 'MPSSVC Rule-Level Policy Change' ) -replace ".*MPSSVC Rule-Level Policy Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit MPSSVC Rule-Level Policy Change
        scored: true
      - id: 17.7.5
        description: "Ensure 'Audit Other Policy Change Events' is set to include 'Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other Policy Change Events" | Select-String -Pattern 'Other Policy Change Events' ) -replace ".*Other Policy Change Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other Policy Change Events" | Select-String -Pattern 'Other Policy Change Events' ) -replace ".*Other Policy Change Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Policy Change\Audit Other Policy Change Events
        scored: true
  - id: 17.8
    description: Privilege Use
    checks:
      - id: 17.8.1
        description: "Ensure 'Audit Sensitive Privilege Use' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Sensitive Privilege Use" | Select-String -Pattern 'Sensitive Privilege Use' ) -replace ".*Sensitive Privilege Use\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Sensitive Privilege Use" | Select-String -Pattern 'Sensitive Privilege Use' ) -replace ".*Sensitive Privilege Use\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\Privilege Use\Audit Sensitive Privilege Use
        scored: true
  - id: 17.9
    description: System
    checks:
      - id: 17.9.1
        description: "Ensure 'Audit IPsec Driver' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"IPsec Driver" | Select-String -Pattern 'IPsec Driver' ) -replace ".*IPsec Driver\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"IPsec Driver" | Select-String -Pattern 'IPsec Driver' ) -replace ".*IPsec Driver\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit IPsec Driver
        scored: true
      - id: 17.9.2
        description: "Ensure 'Audit Other System Events' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Other System Events" | Select-String -Pattern 'Other System Events' ) -replace ".*Other System Events\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Other System Events" | Select-String -Pattern 'Other System Events' ) -replace ".*Other System Events\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Other System Events
        scored: true
      - id: 17.9.3
        description: "Ensure 'Audit Security State Change' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Security State Change" | Select-String -Pattern 'Security State Change' ) -replace ".*Security State Change\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Security State Change" | Select-String -Pattern 'Security State Change' ) -replace ".*Security State Change\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Security State Change
        scored: true
      - id: 17.9.4
        description: "Ensure 'Audit Security System Extension' is set to include 'Success' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"Security System Extension" | Select-String -Pattern 'Security System Extension' ) -replace ".*Security System Extension\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"Security System Extension" | Select-String -Pattern 'Security System Extension' ) -replace ".*Security System Extension\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit Security System Extension
        scored: true
      - id: 17.9.5
        description: "Ensure 'Audit System Integrity' is set to 'Success and Failure' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: (auditpol.exe /get /subcategory:"System Integrity" | Select-String -Pattern 'System Integrity' ) -replace ".*System Integrity\s+", ""
            MemberServer: (auditpol.exe /get /subcategory:"System Integrity" | Select-String -Pattern 'System Integrity' ) -replace ".*System Integrity\s+", ""
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "Success and Failure"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Success' and 'Failure':
             Computer Configuration\Policies\Windows Settings\Security Settings\Advanced Audit Policy Configuration\Audit Policies\System\Audit System Integrity
        scored: true
  - id: 18.1
    description: Control Panel
    checks:
      - id: 18.1.1.1
        description: "Ensure 'Prevent enabling lock screen camera' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization' NoLockScreenCamera
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization' NoLockScreenCamera
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Control Panel\Personalization\Prevent enabling lock screen camera
        scored: true
      - id: 18.1.1.2
        description: "Ensure 'Prevent enabling lock screen slide show' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization' NoLockScreenSlideshow
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization' NoLockScreenSlideshow
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Control Panel\Personalization\Prevent enabling lock screen slide show
        scored: true
      - id: 18.1.2.2
        description: "Ensure 'Allow users to enable online speech recognition services' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\InputPersonalization' AllowInputPersonalization
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\InputPersonalization' AllowInputPersonalization
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Control Panel\Regional and Language Options\Allow users to enable online speech recognition services
        scored: true
      - id: 18.1.3
        description: "Ensure 'Allow Online Tips' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer' AllowOnlineTips
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Control Panel\Allow Online Tips
        scored: true
  - id: 18.3
    description: Microsoft Local Administrator Password Solution (LAPS)
    checks:
      - id: 18.3.1
        description: "Ensure 'Prevent enabling lock screen camera' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions\{D76B9641-3288-4f75-942D-087DE603E3EA}' DllName
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "AdmPwd.dll"
              set: true
        remediation: >
          In order to utilize LAPS, a minor Active Directory Schema update is required,
          and a Group Policy Client Side Extension (CSE) must be installed on each managed computer.
          When LAPS is installed, the file AdmPwd.dll must be present in the following location and registered in Windows
          (the LAPS AdmPwd GPO Extension / CSE installation does this for you):
             C:\Program Files\LAPS\CSE\AdmPwd.dll
        scored: true
      - id: 18.3.2
        description: "Ensure 'Do not allow password expiration time longer than required by policy' is set to 'Enabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' PwdExpirationProtectionEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\LAPS\Do not allow password expiration time longer than required by policy
        scored: true
      - id: 18.3.3
        description: "Ensure 'Enable Local Admin Password Management' is set to 'Enabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' AdmPwdEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\LAPS\Enable Local Admin Password Management
        scored: true
      - id: 18.3.4
        description: "Ensure 'Password Settings: Password Complexity' is set to 'Enabled: Large letters + small letters + numbers + special characters' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' PasswordComplexity
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled'
          and configure the Password Complexity option to Large letters + small letters + numbers + special characters:
             Computer Configuration\Policies\Administrative Templates\LAPS\Password Settings
        scored: true
      - id: 18.3.5
        description: "Ensure 'Password Settings: Password Length' is set to 'Enabled: 15 or more' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' PasswordLength
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 15
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled'
          and configure the Password Complexity option to Large letters + small letters + numbers + special characters:
             Computer Configuration\Policies\Administrative Templates\LAPS\Password Settings
        scored: true
      - id: 18.3.6
        description: "Ensure 'Password Settings: Password Age (Days)' is set to 'Enabled: 30 or fewer' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' PasswordAgeDays
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: 30
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled'
          and configure the 'Password Age (Days)' option to '30 or fewer':
             Computer Configuration\Policies\Administrative Templates\LAPS\Password Settings
        scored: true
  - id: 18.4
    description: MS Security Guide
    checks:
      - id: 18.4.1
        description: "Ensure 'Apply UAC restrictions to local accounts on network logons' is set to 'Enabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System' LocalAccountTokenFilterPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\MS Security Guide\Apply UAC restrictions to local accounts on network logons
        scored: true
      - id: 18.4.2
        description: "Ensure 'Configure RPC packet level privacy setting for incoming connections' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Print' RpcAuthnLevelPrivacyEnabled
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Print' RpcAuthnLevelPrivacyEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\MS Security Guide\Configure RPC packet level privacy setting for incoming connections
        scored: true
      - id: 18.4.3
        description: "Ensure 'Configure SMB v1 client driver' is set to 'Enabled: Disable driver (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\\SYSTEM\CurrentControlSet\Services\mrxsmb10' Start
            MemberServer: Get-ItemPropertyValue 'HKLM:\\SYSTEM\CurrentControlSet\Services\mrxsmb10' Start
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "4"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Disable driver (recommended)':
             Computer Configuration\Policies\Administrative Templates\MS Security Guide\Configure SMB v1 client driver
        scored: true
      - id: 18.4.4
        description: "Ensure 'Configure SMB v1 server' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters' SMB1
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters' SMB1
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\MS Security Guide\Configure SMB v1 server
        scored: true
      - id: 18.4.5
        description: "Ensure 'Enable Structured Exception Handling Overwrite Protection (SEHOP)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\kernel' DisableExceptionChainValidation
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\kernel' DisableExceptionChainValidation
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\MS Security Guide\Enable Structured Exception Handling Overwrite Protection (SEHOP)
        scored: true
      - id: 18.4.6
        description: "Ensure 'NetBT NodeType configuration' is set to 'Enabled: P-node (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NetBT\Parameters' NodeType
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NetBT\Parameters' NodeType
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: P-node (recommended)':
             Computer Configuration\Policies\Administrative Templates\MS Security Guide\NetBT NodeType configuration
        scored: true
      - id: 18.4.7
        description: "Ensure 'WDigest Authentication' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' UseLogonCredential
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' UseLogonCredential
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\MS Security Guide\WDigest Authentication (disabling may require KB2871997)
        scored: true
  - id: 18.5
    description: Microsoft Solutions for Security (MSS) (Legacy)
    checks:
      - id: 18.5.1
        description: "Ensure 'MSS: (AutoAdminLogon) Enable Automatic Logon (not recommended)' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' AutoAdminLogon
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' AutoAdminLogon
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (AutoAdminLogon) Enable Automatic Logon (not recommended)
        scored: true
      - id: 18.5.2
        description: "Ensure 'MSS: (DisableIPSourceRouting IPv6) IP source routing protection level (protects against packet spoofing)' is set to 'Enabled: Highest protection, source routing is completely disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters' DisableIPSourceRouting
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip6\Parameters' DisableIPSourceRouting
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Highest protection, source routing is completely disabled':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (DisableIPSourceRouting IPv6) IP source routing protection level (protects against packet spoofing)
        scored: true
      - id: 18.5.3
        description: "Ensure 'MSS: (DisableIPSourceRouting) IP source routing protection level (protects against packet spoofing)' is set to 'Enabled: Highest protection, source routing is completely disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' DisableIPSourceRouting
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' DisableIPSourceRouting
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Highest protection, source routing is completely disabled':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (DisableIPSourceRouting) IP source routing protection level (protects against packet spoofing)
        scored: true
      - id: 18.5.4
        description: "Ensure 'MSS: (EnableICMPRedirect) Allow ICMP redirects to override OSPF generated routes' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' EnableICMPRedirect
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' EnableICMPRedirect
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (EnableICMPRedirect) Allow ICMP redirects to override OSPF generated routes
        scored: true
      - id: 18.5.5
        description: "Ensure 'MSS: (KeepAliveTime) How often keep-alive packets are sent in milliseconds' is set to 'Enabled: 300,000 or 5 minutes (recommended)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' KeepAliveTime
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' KeepAliveTime
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "300000"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 300,000 or 5 minutes (recommended)':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (KeepAliveTime) How often keep-alive packets are sent in milliseconds
        scored: true
      - id: 18.5.6
        description: "Ensure 'MSS: (NoNameReleaseOnDemand) Allow the computer to ignore NetBIOS name release requests except from WINS servers' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NetBT\Parameters' NoNameReleaseOnDemand
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\NetBT\Parameters' NoNameReleaseOnDemand
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (NoNameReleaseOnDemand) Allow the computer to ignore NetBIOS name release requests except from WINS servers
        scored: true
      - id: 18.5.7
        description: "Ensure 'MSS: (PerformRouterDiscovery) Allow IRDP to detect and configure Default Gateway addresses (could lead to DoS)' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' PerformRouterDiscovery
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' PerformRouterDiscovery
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (PerformRouterDiscovery) Allow IRDP to detect and configure Default Gateway addresses (could lead to DoS)
        scored: true
      - id: 18.5.8
        description: "Ensure 'MSS: (SafeDllSearchMode) Enable Safe DLL search mode (recommended)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager' SafeDllSearchMode
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager' SafeDllSearchMode
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (SafeDllSearchMode) Enable Safe DLL search mode (recommended)
        scored: true
      - id: 18.5.9
        description: "Ensure 'MSS: (ScreenSaverGracePeriod) The time in seconds before the screen saver grace period expires (0 recommended)' is set to 'Enabled: 5 or fewer seconds' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ScreenSaverGracePeriod
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon' ScreenSaverGracePeriod
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: "5"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 5 or fewer seconds':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (ScreenSaverGracePeriod) The time in seconds before the screen saver grace period expires (0 recommended)
        scored: true
      - id: 18.5.10
        description: "Ensure 'MSS: (TcpMaxDataRetransmissions IPv6) How many times unacknowledged data is retransmitted' is set to 'Enabled: 3' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\TCPIP6\Parameters' TcpMaxDataRetransmissions
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\TCPIP6\Parameters' TcpMaxDataRetransmissions
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "3"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 3':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS:(TcpMaxDataRetransmissions IPv6) How many times unacknowledged data is retransmitted
        scored: true
      - id: 18.5.11
        description: "Ensure 'MSS: (TcpMaxDataRetransmissions) How many times unacknowledged data is retransmitted' is set to 'Enabled: 3' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' TcpMaxDataRetransmissions
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters' TcpMaxDataRetransmissions
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "3"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 3':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS:(TcpMaxDataRetransmissions) How many times unacknowledged data is retransmitted
        scored: true
      - id: 18.5.12
        description: "Ensure 'MSS: (WarningLevel) Percentage threshold for the security event log at which the system will generate a warning' is set to 'Enabled: 90% or less' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Eventlog\Security' WarningLevel
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\Eventlog\Security' WarningLevel
        tests:
          test_items:
            - flag: ""
              compare:
                op: lte
                value: "90"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 90% or less':
             Computer Configuration\Policies\Administrative Templates\MSS (Legacy)\MSS: (WarningLevel) Percentage threshold for the security event log at which the system will generate a warning
        scored: true
  - id: 18.6
    description: Network
    checks:
      - id: 18.6.4.1
        description: "Ensure 'Configure DNS over HTTPS (DoH) name resolution' is set to 'Enabled: Allow DoH' or higher (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient' DoHPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient' DoHPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: 2
              set: true
            - flag: ""
              compare:
                op: lte
                value: 3
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Allow DoH' (configuring to 'Enabled: Require DoH' also conforms to the benchmark):
             Computer Configuration\Policies\Administrative Templates\Network\DNS Client\Configure DNS over HTTPS (DoH) name resolution
        scored: true
      - id: 18.6.4.2
        description: "Ensure 'Configure NetBIOS settings' is set to 'Enabled: Disable NetBIOS name resolution on public networks' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient' EnableNetbios
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient' EnableNetbios
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Disable NetBIOS name resolution on public networks':
             Computer Configuration\Policies\Administrative Templates\Network\DNS Client\Configure NetBIOS settings
        scored: true
      - id: 18.6.4.3
        description: "Ensure 'Turn off multicast name resolution' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient' EnableMulticast
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient' EnableMulticast
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Network\DNS Client\Turn off multicast name resolution
        scored: true
      - id: 18.6.5.1
        description: "Ensure 'Enable Font Providers' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' EnableFontProviders
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' EnableFontProviders
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Network\Fonts\Enable Font Providers
        scored: true
      - id: 18.6.8.1
        description: "Ensure 'Enable insecure guest logons' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\LanmanWorkstation' AllowInsecureGuestAuth
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\LanmanWorkstation' AllowInsecureGuestAuth
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Network\Lanman Workstation\Enable insecure guest logons
        scored: true
      - id: 18.6.9.1
        description: "Ensure 'Turn on Mapper I/O (LLTDIO) driver' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\LLTD' EnableLLTDIO
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\LLTD' EnableLLTDIO
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Network\Link-Layer Topology Discovery\Turn on Mapper I/O (LLTDIO) driver
        scored: true
      - id: 18.6.9.2
        description: "Ensure 'Turn on Responder (RSPNDR) driver' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\LLTD' EnableRspndr
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\LLTD' EnableRspndr
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Network\Link-Layer Topology Discovery\Turn on Responder (RSPNDR) driver
        scored: true
      - id: 18.6.10.2
        description: "Ensure 'Turn off Microsoft Peer-to-Peer Networking Services' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Peernet' Disabled
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Peernet' Disabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Network\Microsoft Peer-to-Peer Networking Services\Turn off Microsoft Peer-to-Peer Networking Services
        scored: true
      - id: 18.6.11.2
        description: "Ensure 'Prohibit installation and configuration of Network Bridge on your DNS domain network' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Network Connections' NC_AllowNetBridge_NLA
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Network Connections' NC_AllowNetBridge_NLA
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Network\Network Connections\Prohibit installation and configuration of Network Bridge on your DNS domain network
        scored: true
      - id: 18.6.11.3
        description: "Ensure 'Prohibit use of Internet Connection Sharing on your DNS domain network' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Network Connections' NC_ShowSharedAccessUI
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Network Connections' NC_ShowSharedAccessUI
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Network\Network Connections\Prohibit use of Internet Connection Sharing on your DNS domain network
        scored: true
      - id: 18.6.11.4
        description: "Ensure 'Require domain users to elevate when setting a network's location' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Network Connections' NC_StdDomainUserSetLocation
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Network Connections' NC_StdDomainUserSetLocation
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Network\Network Connections\Require domain users to elevate when setting a network\'s location
        scored: true
      - id: 18.6.14.1
        description: "Ensure 'Hardened UNC Paths' is set to 'Enabled, with 'Require Mutual Authentication' and 'Require Integrity' set for all NETLOGON and SYSVOL shares' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\NetworkProvider\HardenedPaths' '\\*\NETLOGON';Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\NetworkProvider\HardenedPaths' '\\*\SYSVOL'
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\NetworkProvider\HardenedPaths' '\\*\NETLOGON';Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\NetworkProvider\HardenedPaths' '\\*\SYSVOL'
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: >
                   RequireMutualAuthentication=1, RequireIntegrity=1
                   RequireMutualAuthentication=1, RequireIntegrity=1
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled' with the following paths configured, at a minimum:
             '\\*\NETLOGON RequireMutualAuthentication=1, RequireIntegrity=1'
             '\\*\SYSVOL RequireMutualAuthentication=1, RequireIntegrity=1'
             Computer Configuration\Policies\Administrative Templates\Network\Network Provider\Hardened UNC Paths
        scored: true
      - id: 18.6.19.2.1
        description: "Disable IPv6 (Ensure TCPIP6 Parameter 'DisabledComponents' is set to '0xff (255)') (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\TCPIP6\Parameters' DisabledComponents
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Services\TCPIP6\Parameters' DisabledComponents
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "255"
              set: true
        remediation: >
          To establish the recommended configuration, set the following Registry value to '0xff (255) (DWORD)':
             HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\TCPIP6\Parameters:DisabledComponents
        scored: true
      - id: 18.6.20.1
        description: "Ensure 'Configuration of wireless settings using Windows Connect Now' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' EnableRegistrars; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableUPnPRegistrar; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableInBand802DOT11Registrar; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableFlashConfigRegistrar; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableWPDRegistrar
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' EnableRegistrars; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableUPnPRegistrar; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableInBand802DOT11Registrar; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableFlashConfigRegistrar; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\Registrars' DisableWPDRegistrar
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: >
                  0
                  0
                  0
                  0
                  0
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Network\Windows Connect Now\Configuration of wireless settings using Windows Connect Now
        scored: true
      - id: 18.6.20.2
        description: "Ensure 'Prohibit access of the Windows Connect Now wizards' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\UI' DisableWcnUi
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WCN\UI' DisableWcnUi
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Network\Windows Connect Now\Prohibit access of the Windows Connect Now wizards
        scored: true
      - id: 18.6.21.1
        description: "Ensure 'Minimize the number of simultaneous connections to the Internet or a Windows Domain' is set to 'Enabled: 3 = Prevent Wi-Fi when on Ethernet' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WcmSvc\GroupPolicy' fMinimizeConnections
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WcmSvc\GroupPolicy' fMinimizeConnections
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "3"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 3 = Prevent Wi-Fi when on Ethernet':
             Computer Configuration\Policies\Administrative Templates\Network\Windows Connection Manager\Minimize the number of simultaneous connections to the Internet or a Windows Domain
        scored: true
      - id: 18.6.21.2
        description: "Ensure 'Prohibit connection to non-domain networks when connected to domain authenticated network' is set to 'Enabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WcmSvc\GroupPolicy' fBlockNonDomain
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Network\Windows Connection Manager\Prohibit connection to non-domain networks when connected to domain authenticated network
        scored: true
  - id: 18.7
    description: Printers
    checks:
      - id: 18.7.1
        description: "Ensure 'Allow Print Spooler to accept client connections' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers' RegisterSpoolerRemoteRpcEndPoint
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers' RegisterSpoolerRemoteRpcEndPoint
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "2"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\Printers:Allow Print Spooler to accept client connections
        scored: true
      - id: 18.7.2
        description: "Ensure 'Configure Redirection Guard' is set to 'Enabled: Redirection Guard Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers' RedirectionguardPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers' RedirectionguardPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Redirection Guard Enabled':
             Computer Configuration\Policies\Administrative Templates\Printers\Configure Redirection Guard
        scored: true
      - id: 18.7.3
        description: "Ensure 'Configure RPC connection settings: Protocol to use for outgoing RPC connections' is set to 'Enabled: RPC over TCP' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcUseNamedPipeProtocol
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcUseNamedPipeProtocol
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: RPC over TCP':
             Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC connection settings: Protocol to use for outgoing RPC connections
        scored: true
      - id: 18.7.4
        description: "Ensure 'Configure RPC connection settings: Use authentication for outgoing RPC connections' is set to 'Enabled: Default' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcAuthentication
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcAuthentication
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Default':
             Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC connection settings: Protocol to use for outgoing RPC connections
        scored: true
      - id: 18.7.5
        description: "Ensure 'Configure RPC listener settings: Protocols to allow for incoming RPC connections' is set to 'Enabled: RPC over TCP' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcProtocols
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcProtocols
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: RCP over TCP':
             Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC listener settings: Configure protocol options for incoming RPC connections
        scored: true
      - id: 18.7.6
        description: "Ensure 'Configure RPC listener settings: Authentication protocol to use for incoming RPC connections:' is set to 'Enabled: Negotiate' or higher (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' ForceKerberosForRpc
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' ForceKerberosForRpc
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Negotiate' or higher:
             Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC listener settings: Configure protocol options for incoming RPC connections
        scored: true
      - id: 18.7.7
        description: "Ensure 'Configure RPC over TCP port' is set to 'Enabled: 0' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcTcpPort
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\RPC' RpcTcpPort
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 0':
             Computer Configuration\Policies\Administrative Templates\Printers\Configure RPC over TCP port
        scored: true
      - id: 18.7.8
        description: "Ensure 'Limits print driver installation to Administrators' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint' trictDriverInstallationToAdministrators
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint' trictDriverInstallationToAdministrators
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: 0':
             Computer Configuration\Policies\Administrative Templates\Printers\Limits print driver installation to Administrators
        scored: true
      - id: 18.7.9
        description: "Ensure 'Manage processing of Queue-specific files' is set to 'Enabled: Limit Queue-specific files to Color profiles' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers' CopyFilesPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers' CopyFilesPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Limit Queue-specific files to Color profiles':
             Computer Configuration\Policies\Administrative Templates\Printers\Manage processing of Queue-specific files
        scored: true
      - id: 18.7.10
        description: "Ensure 'Point and Print Restrictions: When installing drivers for a new connection' is set to 'Enabled: Show warning and elevation prompt' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint' NoWarningNoElevationOnInstall
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint' NoWarningNoElevationOnInstall
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Show warning and elevation prompt':
             Computer Configuration\Policies\Administrative Templates\Printers\Point and Print Restrictions: When installing drivers for a new connection
        scored: true
      - id: 18.7.11
        description: "Ensure 'Point and Print Restrictions: When updating drivers for an existing connection' is set to 'Enabled: Show warning and elevation prompt' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers\PointAndPrint' UpdatePromptSettings
            MemberServer: Get-ItemPropertyValue 'HKLM:\Software\Policies\Microsoft\Windows NT\Printers\PointAndPrint' UpdatePromptSettings
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Show warning and elevation prompt':
             Computer Configuration\Policies\Administrative Templates\Printers\Point and Print Restrictions: When updating drivers for an existing connection
        scored: true
  - id: 18.8
    description: Start Menu and Taskbar
    checks:
      - id: 18.8.1.1
        description: "Ensure 'Turn off notifications network usage' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\PushNotifications' NoCloudApplicationNotification
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\PushNotifications' NoCloudApplicationNotification
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\Start Menu and Taskbar\Turn off notifications network usage
        scored: true
  - id: 18.9
    description: System
    checks:
      - id: 18.9.3.1
        description: "Ensure 'Include command line in process creation events' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit' ProcessCreationIncludeCmdLine_Enabled
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Audit' ProcessCreationIncludeCmdLine_Enabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Audit Process Creation\Include command line in process creation events
        scored: true
      - id: 18.9.4.1
        description: "Ensure 'Encryption Oracle Remediation' is set to 'Enabled: Force Updated Clients' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\CredSSP\Parameters' AllowEncryptionOracle
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\CredSSP\Parameters' AllowEncryptionOracle
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Force Updated Clients':
             Computer Configuration\Policies\Administrative Templates\System\Credentials Delegation\Encryption Oracle Remediation
        scored: true
      - id: 18.9.4.2
        description: "Ensure 'Remote host allows delegation of non-exportable credentials' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\CredentialsDelegation' AllowProtectedCreds
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\CredentialsDelegation' AllowProtectedCreds
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Credentials Delegation\Remote host allows delegation of non-exportable credentials
        scored: true
      - id: 18.9.5.1
        description: "Ensure 'Turn On Virtualization Based Security' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' EnableVirtualizationBasedSecurity
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' EnableVirtualizationBasedSecurity
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security
        scored: true
      - id: 18.9.5.2
        description: "Ensure 'Turn On Virtualization Based Security: Select Platform Security Level' is set to 'Secure Boot' or higher (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' RequirePlatformSecurityFeatures
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' RequirePlatformSecurityFeatures
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Secure Boot' or 'Secure Boot and DMA Protection':
             Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Select Platform Security Level
        scored: true
      - id: 18.9.5.3
        description: "Ensure 'Turn On Virtualization Based Security: Virtualization Based Protection of Code Integrity' is set to 'Enabled with UEFI lock' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' HypervisorEnforcedCodeIntegrity
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' HypervisorEnforcedCodeIntegrity
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled with UEFI lock':
             Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Virtualization Based Protection of Code Integrity
        scored: true
      - id: 18.9.5.4
        description: "Ensure 'Turn On Virtualization Based Security: Require UEFI Memory Attributes Table' is set to 'True (checked)' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' HVCIMATRequired
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' HVCIMATRequired
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'TRUE':
             Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Require UEFI Memory Attributes Table
        scored: true
      - id: 18.9.5.5
        description: "Ensure 'Turn On Virtualization Based Security: Credential Guard Configuration' is set to 'Enabled with UEFI lock' (MS Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' LsaCfgFlags
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled with UEFI lock' (on Member Servers only):':
             Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Credential Guard Configuration
        scored: true
      - id: 18.9.5.6
        description: "Ensure 'Turn On Virtualization Based Security: Credential Guard Configuration' is set to 'Disabled' (DC Only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' LsaCfgFlags
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Credential Guard Configuration
        scored: true
      - id: 18.9.5.7
        description: "Ensure 'Turn On Virtualization Based Security: Secure Launch Configuration' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' ConfigureSystemGuardLaunch
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\DeviceGuard' ConfigureSystemGuardLaunch
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Device Guard\Turn On Virtualization Based Security: Secure Launch Configuration
        scored: true
      - id: 18.9.7.2
        description: "Ensure 'Prevent device metadata retrieval from the Internet' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Device Metadata' PreventDeviceMetadataFromNetwork
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Device Metadata' PreventDeviceMetadataFromNetwork
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Device Installation\Prevent device metadata retrieval from the Internet
        scored: true
      - id: 18.9.13.1
        description: "Ensure 'Boot-Start Driver Initialization Policy' is set to 'Enabled: Good, unknown and bad but critical' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Policies\EarlyLaunch' DriverLoadPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Policies\EarlyLaunch' DriverLoadPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "3"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Good, unknown and bad but critical':
             Computer Configuration\Policies\Administrative Templates\System\Early Launch Antimalware\Boot-Start Driver Initialization Policy
        scored: true
      - id: 18.9.19.2
        description: "Ensure 'Configure registry policy processing: Do not apply during periodic background processing' is set to 'Enabled: FALSE' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Group Policy\{35378EAC-683F-11D2-A89A-00C04FBBCFA2}' NoBackgroundPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Group Policy\{35378EAC-683F-11D2-A89A-00C04FBBCFA2}' NoBackgroundPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled', then set the 'Do not apply during periodic background processing' option to 'FALSE' (unchecked):
             Computer Configuration\Policies\Administrative Templates\System\Group Policy\Configure registry policy processing
        scored: true
      - id: 18.9.20.1.1
        description: "Ensure 'Turn off downloading of print drivers over HTTP' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers' DisableWebPnPDownload
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers' DisableWebPnPDownload
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off downloading of print drivers over HTTP
        scored: true
      - id: 18.9.20.1.2
        description: "Ensure 'Turn off handwriting personalization data sharing' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\TabletPC' PreventHandwritingDataSharing
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\TabletPC' PreventHandwritingDataSharing
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off handwriting personalization data sharing
        scored: true
      - id: 18.9.20.1.3
        description: "Ensure 'Turn off handwriting recognition error reporting' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\HandwritingErrorReports' PreventHandwritingErrorReports
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\HandwritingErrorReports' PreventHandwritingErrorReports
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off handwriting recognition error reporting
        scored: true
      - id: 18.9.20.1.4
        description: "Ensure 'Turn off Internet Connection Wizard if URL connection is referring to Microsoft.com' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Internet Connection Wizard' ExitOnMSICW
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Internet Connection Wizard' ExitOnMSICW
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off Internet Connection Wizard if URL connection is referring to Microsoft.com
        scored: true
      - id: 18.9.20.1.5
        description: "Ensure 'Turn off Internet download for Web publishing and online ordering wizards' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer' NoWebServices
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer' NoWebServices
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off Internet download for Web publishing and online ordering wizards
        scored: true
      - id: 18.9.20.1.6
        description: "Ensure 'Turn off printing over HTTP' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers' DisableHTTPPrinting
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Printers' DisableHTTPPrinting
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off printing over HTTP
        scored: true
      - id: 18.9.20.1.7
        description: "Ensure 'Turn off Registration if URL connection is referring to Microsoft.com' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Registration Wizard Control' NoRegistration
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Registration Wizard Control' NoRegistration
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off Registration if URL connection is referring to Microsoft.com
        scored: true
      - id: 18.9.20.1.8
        description: "Ensure 'Turn off Search Companion content file updates' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\SearchCompanion' DisableContentFileUpdates
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\SearchCompanion' DisableContentFileUpdates
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off Search Companion content file updates
        scored: true
      - id: 18.9.20.1.9
        description: "Ensure 'Turn off the \"Order Prints\" picture task' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer' NoOnlinePrintsWizard
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer' NoOnlinePrintsWizard
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off the "Order Prints" picture task
        scored: true
      - id: 18.9.20.1.10
        description: "Ensure 'Turn off the \"Publish to Web\" task for files and folders' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer' NoPublishingWizard
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer' NoPublishingWizard
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off the "Publish to Web" task for files and folders
        scored: true
      - id: 18.9.20.1.11
        description: "Ensure 'Turn off the Windows Messenger Customer Experience Improvement Program' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Messenger\Client' CEIP
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Messenger\Client' CEIP
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off the Windows Messenger Customer Experience Improvement Program
        scored: true
      - id: 18.9.20.1.12
        description: "Ensure 'Turn off Windows Customer Experience Improvement Program' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\SQMClient\Windows' CEIPEnable
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\SQMClient\Windows' CEIPEnable
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off Windows Customer Experience Improvement Program
        scored: true
      - id: 18.9.20.1.13
        description: "Ensure 'Turn off Windows Error Reporting' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Windows Error Reporting' Disabled
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Windows Error Reporting' Disabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Internet Communication Management\Internet Communication settings\Turn off Windows Error Reporting
        scored: true
      - id: 18.9.23.1
        description: "Ensure 'Support device authentication using certificate' is set to 'Enabled: Automatic' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\kerberos\parameters' DevicePKInitBehavior; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\kerberos\parameters' DevicePKInitEnabled
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\kerberos\parameters' DevicePKInitBehavior; Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\kerberos\parameters' DevicePKInitEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0\n1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Automatic':
             Computer Configuration\Policies\Administrative Templates\System\Kerberos\Support device authentication using certificate
        scored: true
      - id: 18.9.24.1
        description: "Ensure 'Enumeration policy for external devices incompatible with Kernel DMA Protection' is set to 'Enabled: Block All' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Kernel DMA Protection' DeviceEnumerationPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\Kernel DMA Protection' DeviceEnumerationPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Block All':
             Computer Configuration\Policies\Administrative Templates\System\Kernel DMA Protection\Enumeration policy for external devices incompatible with Kernel DMA Protection
        scored: true
      - id: 18.9.25.1
        description: "Ensure 'Allow Custom SSPs and APs to be loaded into LSASS' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' AllowCustomSSPsAPs
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' AllowCustomSSPsAPs
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Local Security Authority\Allow Custom SSPs and APs to be loaded into LSASS
        scored: true
      - id: 18.9.25.2
        description: "Ensure 'Configures LSASS to run as a protected process' is set to 'Enabled: Enabled with UEFI Lock' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' RunAsPPL
            MemberServer: Get-ItemPropertyValue 'HKLM:\SYSTEM\CurrentControlSet\Control\Lsa' RunAsPPL
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Enabled with UEFI Lock':
             Computer Configuration\Policies\Administrative Templates\System\Local Security Authority\Configures LSASS to run as a protected process
        scored: true
      - id: 18.9.26.1
        description: "Ensure 'Disallow copying of user input methods to the system account for sign-in' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\ControlPanel\International' BlockUserInputMethodsForSignIn
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\ControlPanel\International' BlockUserInputMethodsForSignIn
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Locale Services\Disallow copying of user input methods to the system account for sign-in
        scored: true
      - id: 18.9.27.1
        description: "Ensure 'Block user from showing account details on sign-in' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' BlockUserFromShowingAccountDetailsOnSignin
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' BlockUserFromShowingAccountDetailsOnSignin
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Logon\Block user from showing account details on sign-in
        scored: true
      - id: 18.9.27.2
        description: "Ensure 'Do not display network selection UI' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' DontDisplayNetworkSelectionU
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' DontDisplayNetworkSelectionU
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Logon\Do not display network selection UI
        scored: true
      - id: 18.9.27.3
        description: "Ensure 'Do not enumerate connected users on domain-joined computers' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' DontEnumerateConnectedUsers
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' DontEnumerateConnectedUsers
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Logon\Do not enumerate connected users on domain-joined computers
        scored: true
      - id: 18.9.27.4
        description: "Ensure 'Enumerate local users on domain-joined computers' is set to 'Disabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' EnumerateLocalUsers
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Logon\Enumerate local users on domain-joined computers
        scored: true
      - id: 18.9.27.5
        description: "Ensure 'Turn off app notifications on the lock screen' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' DisableLockScreenAppNotifications
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' DisableLockScreenAppNotifications
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Logon\Turn off app notifications on the lock screen
        scored: true
      - id: 18.9.27.6
        description: "Ensure 'Turn off picture password sign-in' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' BlockDomainPicturePassword
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' BlockDomainPicturePassword
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Logon\Turn off picture password sign-in
        scored: true
      - id: 18.9.27.7
        description: "Ensure 'Turn on convenience PIN sign-in' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' AllowDomainPINLogon
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' AllowDomainPINLogon
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Logon\Turn off picture password sign-in
        scored: true
      - id: 18.9.30.1
        description: "Ensure 'Allow Clipboard synchronization across devices' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' AllowCrossDeviceClipboard
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' AllowCrossDeviceClipboard
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\OS Policies\Allow Clipboard synchronization across devices
        scored: true
      - id: 18.9.30.2
        description: "Ensure 'Allow upload of User Activities' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' UploadUserActivities
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\System' UploadUserActivities
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\OS Policies\Allow upload of User Activities
        scored: true
      - id: 18.9.32.6.1
        description: "Ensure 'Allow network connectivity during connected-standby (on battery)' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\f15576e8-98b7-4186-b944-eafa664402d9' DCSettingIndex
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\f15576e8-98b7-4186-b944-eafa664402d9' DCSettingIndex
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Power Management\Sleep Settings\Allow network connectivity during connected-standby (on battery)
        scored: true
      - id: 18.9.32.6.2
        description: "Ensure 'Allow network connectivity during connected-standby (plugged in)' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\f15576e8-98b7-4186-b944-eafa664402d9' ACSettingIndex
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\f15576e8-98b7-4186-b944-eafa664402d9' ACSettingIndex
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Power Management\Sleep Settings\Allow network connectivity during connected-standby (plugged in)
        scored: true
      - id: 18.9.32.6.3
        description: "Ensure 'Require a password when a computer wakes (on battery)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\0e796bdb-100d-47d6-a2d5-f7d2daa51f51' DCSettingIndex
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\0e796bdb-100d-47d6-a2d5-f7d2daa51f51' DCSettingIndex
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Power Management\Sleep Settings\Require a password when a computer wakes (on battery)
        scored: true
      - id: 18.9.32.6.4
        description: "Ensure 'Require a password when a computer wakes (plugged in)' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\0e796bdb-100d-47d6-a2d5-f7d2daa51f51' ACSettingIndex
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Power\PowerSettings\0e796bdb-100d-47d6-a2d5-f7d2daa51f51' ACSettingIndex
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Power Management\Sleep Settings\Require a password when a computer wakes (plugged in)
        scored: true
      - id: 18.9.34.1
        description: "Ensure 'Configure Offer Remote Assistance' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' fAllowUnsolicited
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' fAllowUnsolicited
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Remote Assistance\Configure Offer Remote Assistance
        scored: true
      - id: 18.9.34.2
        description: "Ensure 'Configure Solicited Remote Assistance' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' fAllowToGetHelp
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services' fAllowToGetHelp
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Remote Assistance\Configure Solicited Remote Assistance
        scored: true
      - id: 18.9.35.1
        description: "Ensure 'Enable RPC Endpoint Mapper Client Authentication' is set to 'Enabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Rpc' EnableAuthEpResolution
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Remote Procedure Call\Enable RPC Endpoint Mapper Client Authentication
        scored: true
      - id: 18.9.35.2
        description: "Ensure 'Restrict Unauthenticated RPC clients' is set to 'Enabled: Authenticated' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Rpc' RestrictRemoteClients
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Authenticated':
             Computer Configuration\Policies\Administrative Templates\System\Remote Procedure Call\Restrict Unauthenticated RPC clients
        scored: true
      - id: 18.9.38.1
        description: "Ensure 'Configure validation of ROCA-vulnerable WHfB keys during authentication' is set to 'Enabled: Audit' or higher (DC only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\SAM' SamNGCKeyROCAValidation
        tests:
          test_items:
            - flag: ""
              compare:
                op: gte
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled: Audit' (configuring to 'Enabled: Block' also conforms to the benchmark):
             Computer Configuration\Policies\Administrative Templates\System\Security Account Manager\Configure validation of ROCA-vulnerable WHfB keys during authentication
        scored: true
      - id: 18.9.46.5.1
        description: "Ensure 'Microsoft Support Diagnostic Tool: Turn on MSDT interactive communication with support provider' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\ScriptedDiagnosticsProvider\Policy' DisableQueryRemoteServer
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\ScriptedDiagnosticsProvider\Policy' DisableQueryRemoteServer
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Troubleshooting and Diagnostics\Microsoft Support Diagnostic Tool\Microsoft Support Diagnostic Tool: Turn on MSDT interactive communication with support provider
        scored: true
      - id: 18.9.46.11.1
        description: "Ensure 'Enable/Disable PerfTrack' is set to 'Disabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WDI\{9c5a40da-b965-4fc3-8781-88dd50a6299d}' ScenarioExecutionEnabled
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\WDI\{9c5a40da-b965-4fc3-8781-88dd50a6299d}' ScenarioExecutionEnabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Troubleshooting and Diagnostics\Windows Performance PerfTrack\Enable/Disable PerfTrack
        scored: true
      - id: 18.9.48.1
        description: "Ensure 'Turn off the advertising ID' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\AdvertisingInfo' DisabledByGroupPolicy
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\Windows\AdvertisingInfo' DisabledByGroupPolicy
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\User Profiles\Turn off the advertising ID
        scored: true
      - id: 18.9.50.1
        description: "Ensure 'Enable Windows NTP Client' is set to 'Enabled' (Automated)"
        audittype: powershell
        audit:
          cmd:
            DomainController: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\W32Time\TimeProviders\NtpClient' Enabled
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\W32Time\TimeProviders\NtpClient' Enabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "1"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Enabled':
             Computer Configuration\Policies\Administrative Templates\System\Windows Time Service\Time Providers\Enable Windows NTP Client
        scored: true
      - id: 18.9.50.2
        description: "Ensure 'Enable Windows NTP Server' is set to 'Disabled' (MS only) (Automated)"
        audittype: powershell
        audit:
          cmd:
            MemberServer: Get-ItemPropertyValue 'HKLM:\SOFTWARE\Policies\Microsoft\W32Time\TimeProviders\NtpServer' Enabled
        tests:
          test_items:
            - flag: ""
              compare:
                op: eq
                value: "0"
              set: true
        remediation: >
          To establish the recommended configuration via GP, set the following UI path to 'Disabled':
             Computer Configuration\Policies\Administrative Templates\System\Windows Time Service\Time Providers\Enable Windows NTP Server
        scored: true
