---
controls:
version: 1.1.0
id: 1
description: "Account Policies"  
type: "domain-controller"
groups:
- id: 1.1
  description: "Password Policy"
  checks:
    - id: 1.1.1
      description: "Ensure 'Enforce password history' is set to '24 or more password(s)' (Automated)"
      audittype: "powershell"
      audit: 
        cmd:
          DomainController: "Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select -ExpandProperty PasswordHistoryCount"
          Server: "Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select -ExpandProperty PasswordHistoryCount"
      tests:
        test_items:
        - flag: ""
          compare:
            op: gte
            value: 24
          set: true
      remediation: |
        To establish the recommended configuration via GP, set the following UI path to 24 or more password(s):
          Computer Configuration\Policies\Windows Settings\Security Settings\Account
          Policies\Password Policy\Enforce password history
      scored: true
    - id: 1.1.2
      description: "Ensure 'Maximum password age' is set to '365 or fewer days, but not 0' (Automated)"
      audittype: "powershell"
      audit: 
        cmd:
          DomainController: "Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select -ExpandProperty MaxPasswordAge | Select -ExpandProperty TotalDays"
          Server: "Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select -ExpandProperty MaxPasswordAge | Select -ExpandProperty TotalDays"
      tests:
        bin_op: and
        test_items:
        - flag: ""
          compare:
            op: lte
            value: 365
          set: true
        - flag: ""
          compare:
            op: noteq
            value: 0
          set: true
      remediation: |
        To establish the recommended configuration via GP, set the following UI path to 365 or fewer days, but not 0:
         Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Maximum password age
      scored: true
    - id: 1.1.3
      description: "Ensure 'Minimum password age' is set to '1 or more day(s)' (Automated)"
      audittype: "powershell"
      audit: 
        cmd:
          DomainController: "Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select -ExpandProperty MinPasswordAge | Select -ExpandProperty TotalDays"
          Server: "Get-ADDefaultDomainPasswordPolicy -Current LocalComputer | Select -ExpandProperty MinPasswordAge | Select -ExpandProperty TotalDays"
      tests:
        test_items:
        - flag: ""
          compare:
            op: gte
            value: 1
          set: true
      remediation: |
        To establish the recommended configuration via GP, set the following UI path to 1 or more day(s):
           Computer Configuration\Policies\Windows Settings\Security Settings\Account Policies\Password Policy\Minimum password age
      scored: true
